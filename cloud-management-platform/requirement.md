# 云管平台需求分析文档

## 云管平台的定位

云管理平台（CMP）为云服务客户提供了一种手段来管理跨多个云服务基础架构（包括本地云基础设施和公共云服务提供商基础架构）的应用程序和相关数据集的部署和操作。
即：云管理平台为混合云（多云）环境提供了管理功能。

云管平台侧重于面向用户和业务，旨在为用户提供统一的云服务入口，给用户提供一个简单直观的手段来使用和管理自己的云资源，比如用户可以更快捷的申请到云实例，可以对云
实例做简单的开关机/重启等操作。云管平台另外一个重要的作用，是针对底层的资源池做数据统计，并在统一的入口呈现。

云管平台并不过多涉及底层资源池的管理，所以，它并不是管理各个资源池的统一入口，**云管平台不是设计来替代vCenter或者DTcenter的***

## 云管平台目标

1. 建立自服务门户
    * BGIOA为资源申请的统一入口，用户可以自助提交实例申请单，无需过多的线下或邮件沟通
    * 申请处理完成后，申请人可以登录云管平台查询并操作自己名下的实例
2. 实现云资源自动化交付
    * 申请人在OA提单后，在OA上完成审批，审批通过后，OA将表单信息推送给云管平台
    * 云管平台接收到OA传递的表单信息，自动创建实例，并反馈给申请人
    * 云管平台维护一个常用软件仓库，申请人申请实例时，可以同时勾选定义好的常用软件，在实例交付使用前，云管平台会自动安装配置好这些自定义的软件
3. 实现资源的全生命周期管理
    * 通过云管平台申请的实例，须指定实例的有效期，到期前会提前通知申请人，申请人可以选择续期或者到期释放实例，实现实例从申请 -- 上线 -- 回收的全生命周期管理
    * 申请人及指定的管理员为实例的负责人，所有实例状态的变更、实例相关的信息安全事件都会通知到负责人，无主实例会在设定的缓冲期之后停机并回收，避免出现大量的运行状态的无主实例
4. 实现云资源费用管理（成本分析）
    * 对公有云，按O2、O3部门统计资源使用量和费用，并展示变化趋势
    * 对私有云，按O2、O3部门统计资源使用量，并展示变化趋势
    * 上述统计，可以通过网页查询，并自动发送Excel格式的报表

5. 监控
   * 收集线上、线下所有实例（虚机、物理机、GPU等）的监控数据，通过统一的平台展示
   * 对发布公网的业务，建立基于多云架构的服务质量监控体系

> 对外业务服务质量监控的示例：   
> [AWS Cloud HTTP Ping](http://cloudping.today/)    
> [网站测速工具](https://www.17ce.com/)

## 实例创建

* 管理员填好表单，点击创建实例，弹出一个提示框，提示是否创建成功，此时不提示是否发送邮件成功
* 提示框显示创建成功后，点击确认，跳转到清单页面
* 提示框显示创建失败，点击确认，跳转到创建实例页面，页面最上方显示创建失败的原因，管理员可以根据提示修改输入参数或联系阿里云客服
* 实例创建成功后，发送邮件给申请人，并cc给操作的管理员；当邮件发送失败时，重试5次，仍然失败的话，在消息中心生成一条告警信息，管理员可以手动重新发送

发送给申请人的邮件模板如下：
```
您好，您的主机资源申请（OA单号：2018xxxx-I10-0001）已处理完成，请查收如下信息：

| IP地址 | 账号 | 默认密码 |

注：
1. 如您的主机需要上网，请使用代理服务器，参考文档：http://xxxx.com/set_proxy.html
2. 如您的主机需要开通内外网端口，请在OA上提交IP及防火墙业务申请

```


## 搜索需求

### 全站搜索
因暂无文档页面，全站搜索功能暂停

### 清单页面搜索
可以按照实例ID、实例名称、IP地址等列信息进行搜索，返回满足搜索条件的清单列表，可参考如下示例：
![](https://i.imgur.com/cQfjag0.png)

### 增加 显示我的机器 和 显示全部机器 2个选项，一个用户既是管理员又是用户时快速显示

## 用户管理
* 用户账号和AD整合，不需要新建账号系统，是否集成到单点登陆可以延迟考虑。    
* 云管平台的用户分为3类：   
 *  **管理员**： 可以批准创建实例；处理待办事项；处理告警事件；批量转移实例；添加/删除管理员；添加/删除IT用户
 *  **普通用户**：查看自己名下实例信息包括监控图表； 简单的实例操作（开关机，重启等）；将自己名下的资源转移给其他人（支持批量转移）
 *  **IT用户**：授予有需要的IT人员，可以自行查询相关的实例信息
* 用户列表中只显示管理员及IT用户清单，普通用户不显示
* 管理员需要授予普通用户`管理员`或`IT用户`权限时，需在用户列表中查询，如该用户之前没有使用过云管平台，则直接到EHR中间库中查询，并将该用户直接添加到云管平台数据库，无需管理员单独添加用户  

## 操作日志
* 操作日志选项直接放在导航栏，不要隐藏在用户选项的下拉菜单里   
* 云管平台保留管理员及用户的全部操作记录，格式如下:

| 用户名 | 登录IP | 时间戳 | 操作 |
| ----- | ------ | ------ | ---- |

操作包括：登录、退出、开机、关机、重启、机器转移、实例创建等，并包括操作的对象及结果，如：   
1. 重启实例192.168.224.131 成功   
2. 实例192.168.44.22 创建成功   
3. 实例192.168.44.23 转移给用户`田晶`,转移成功   


## 线上资源自动发现
云管平台定期扫描线上的资源信息，并和云管平台保存的数据进行比对，两类信息需在消息中心提示，要求管理员处理
* 线上有，云管平台没有的实例，按照清单要求列出所有信息，提示管理员确认是否添加到云管的清单中
* 线上有，云管也有，线上线下信息不一致，列出不一致信息，提示管理员确认如何修改

